<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>CPD Units Management</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/business-casual.min.css" rel="stylesheet">

</head>

    <body>

            <h1 class="site-heading text-center text-white d-none d-lg-block">
                    <span class="site-heading-upper text-primary mb-3">Continuing Professional Development</span>
                    <span class="site-heading-lower">Units Management</span>
                  </h1>
                
                  <!-- Navigation -->
                  <nav class="navbar navbar-expand-lg navbar-dark py-lg-4" id="mainNav">
                    <div class="container">
                      <a class="navbar-brand text-uppercase text-expanded font-weight-bold d-lg-none" href="#">CPD Units Management</a>
                      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                      </button>
                      <div class="collapse navbar-collapse" id="navbarResponsive">
                        <ul class="navbar-nav mx-auto">
                          <li class="nav-item px-lg-4">
                            <a class="nav-link text-uppercase text-expanded" href="home.html">Home
                              <span class="sr-only">(current)</span>
                            </a>
                          </li>
                          <li class="nav-item active px-lg-4">
                            <a class="nav-link text-uppercase text-expanded" href="index.html">Units Management</a>
                          </li>
                        </ul>
                      </div>
                    </div>
				  </nav>
				  
				  <section class="page-section">
				  <div class="container">
					<div class="form-group">
							  <button id="btn_supply">Set Supply</button>
						</div>          
						<p id="display_supply"></p>
				 </div>    
				 </section>

                  <section class="page-section">
                        <div class="container">
                          <div class="form-group">
                            <h1 id="lbl_transfer">Transfer</h1>
                            
                            <label for="transferto" id ="lbl_transferto">Transfer to:</label>
                            <input type="text" class="form-control" id="transferto">

                            <label for="transfervalue" id ="lbl_transfervalue">Value:</label>
                            <input type="text" class="form-control" id="transfervalue">
						  </div>          
						  
                        <button id="btn_transfer">Transfer</button>
                        </div>      
					  </section>
					  
					  <section class="page-section">
							<div class="container">
							  <div class="form-group">
									<h1 id="lbl_transfer">Check Balance</h1>
								<label for="balance" id ="lbl_balance">Account Address: </label>
								<input type="text" class="form-control" id="accountbalance">
							  </div>          
						
							<button id="btn_balance">Check</button>
							
							</br></br><p id="display_balance"></p>
							</div>      
					  </section>
					               
                  <footer class="footer text-faded text-center py-5">
                    <div class="container">
                      <p class="m-0 small">Copyright &copy; 2019</p>
                    </div>
                  </footer>

        <!-- Bootstrap core JavaScript -->
        <script src="vendor/jquery/jquery.min.js"></script>
        <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>


        <script src = "https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js"></script>
        <script src = "https://code.jquery.com/jquery-3.3.1.slim.min.js" crossorigin="anonymous"></script>

        <script>
                var contract;

                $(document).ready(function()   
                {
                    web3 = new Web3(web3.currentProvider);
                    web3.eth.defaultAccount = web3.eth.accounts[0];

                    var address = "0x7598912b49A7b68A01bbA7E595007561ACFdA387";
                    var abi = [
	{
		"constant": false,
		"inputs": [],
		"name": "SetTotalSupply",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "RequestofInstitution",
		"outputs": [
			{
				"name": "_requestingInstitution",
				"type": "address"
			},
			{
				"name": "_requestedCPDunitsofInstiution",
				"type": "uint256"
			},
			{
				"name": "_addressofPRC",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_owner",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"name": "balance",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "RequestofTeacher",
		"outputs": [
			{
				"name": "_requestingTeacher",
				"type": "address"
			},
			{
				"name": "requestedCPDunitsofTeacher",
				"type": "uint256"
			},
			{
				"name": "_addressofInstitution",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_requestingTeacher",
				"type": "address"
			},
			{
				"name": "requestedCPDunitsofTeacher",
				"type": "uint256"
			},
			{
				"name": "_addressofInstitution",
				"type": "address"
			}
		],
		"name": "StoreRequestTeacher",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_to",
				"type": "address"
			},
			{
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"name": "success",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_requestingInstitution",
				"type": "address"
			},
			{
				"name": "_requestedCPDunitsofInstiution",
				"type": "uint256"
			},
			{
				"name": "_addressofPRC",
				"type": "address"
			}
		],
		"name": "StoreRequestInstitution",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"name": "_from",
				"type": "address"
			},
			{
				"indexed": true,
				"name": "_to",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "_value",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	}
]
                  
                    contract = new web3.eth.Contract(abi,address);                
                })

                $('#btn_transfer').click(function()
                {
                    var val = 0;
                    var address = web3.utils.toChecksumAddress($('#transferto').val())
                    
                    val = parseInt($('#transfervalue').val());

                    web3.eth.getAccounts().then(function(accounts)
                    {
                        var acc = accounts[0]; //PRC
						var acc1 = accounts[1]; //Teacher
                        return contract.methods.transfer(address, val).send({from: acc, to: acc1});
                    }).then(function(tx)
                    {
                        console.log(tx);
                    }).catch(function(tx)
                    {
                        console.log(tx);
                    })
                })

				$('#btn_balance').click(function()
                {
					var aaddress = web3.utils.toChecksumAddress($('#accountbalance').val())

					web3.eth.getAccounts().then(function(accounts)
                    {
                        return contract.methods.balanceOf(aaddress).call().then(function(bal)
						{
							$('#display_balance').html("Your current balance is: " + bal + " units");
						})
                    })
                })

				/*$('#btn_supply').click(function()
                {
					web3.eth.getAccounts().then(function(accounts)
                    {
                        return contract.methods.SetTotalSupply().call().then(function(tsupply)
						{
							console.log("asas");
							$('#display_supply').html("Total Units: " + tsupply);
						})
                    })
                })*/
        </script>
    </body>
</html>